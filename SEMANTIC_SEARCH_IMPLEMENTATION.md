# èªæ„æœå°‹åŠŸèƒ½å¯¦æ–½ç¸½çµ

## ğŸ“‹ å¯¦æ–½æ¦‚è¦½

**å¯¦æ–½æ—¥æœŸ**: 2025-10-03  
**åŠŸèƒ½**: AI Agent èªæ„æœå°‹æ•´åˆ  
**ç›®çš„**: è§£æ±ºåŒç¾©è©åŒ¹é…å’Œè‡ªç„¶èªè¨€ç†è§£å•é¡Œ

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. MCP Server å¯¦ä½œ (d:\esmcp\lawsowl_mcp.py)

#### æ–°å¢åŠŸèƒ½:
- âœ… `call_openai_embedding()` - OpenAI Embedding API èª¿ç”¨å‡½æ•¸
- âœ… `SemanticSearchParams` - èªæ„æœå°‹åƒæ•¸æ¨¡å‹
- âœ… `semantic_search_judgments()` - èªæ„æœå°‹å·¥å…·

#### æŠ€è¡“ç´°ç¯€:
```python
# å‘é‡åŒ–
model: text-embedding-3-large
dimensions: 1536
similarity: cosine

# kNN æœå°‹
field: summary_ai_vector (é è¨­)
k: limit (ç”¨æˆ¶æŒ‡å®š)
num_candidates: limit * 2
```

#### æ”¯æŒçš„å‘é‡æ¬„ä½:
- `summary_ai_vector` - é€šç”¨æœå°‹ (é è¨­)
- `text_embedding` - æ·±åº¦å…§å®¹æœå°‹
- `legal_issues_embedding` - æ³•å¾‹çˆ­é»æœå°‹

### 2. AI Agent æ•´åˆ (d:\court_data\courtDataAPI)

#### æ›´æ–°æ–‡ä»¶:
- âœ… `utils/ai-agent-tools.js` - æ·»åŠ  `semantic_search_judgments` å·¥å…·å®šç¾©
- âœ… `controllers/ai-agent-controller.js` - è¨»å†Šæ–°å·¥å…·åˆ° MCP å·¥å…·åˆ—è¡¨
- âœ… ç³»çµ±æç¤ºè©æ›´æ–° - æ·»åŠ å·¥å…·é¸æ“‡ç­–ç•¥å’Œç¯„ä¾‹

#### å·¥å…·é¸æ“‡ç­–ç•¥:
```
é—œéµè©æœå°‹ (search_judgments):
- æ˜ç¢ºçš„æ¨™æº–æ¡ˆç”±åç¨±
- ç²¾ç¢ºçš„åˆ¤æ±ºå­—è™Ÿ
- æ—¥æœŸç¯„åœéæ¿¾

èªæ„æœå°‹ (semantic_search_judgments):
- å£èªåŒ–æè¿°
- åŒç¾©è©åŒ¹é…
- æ¨¡ç³ŠæŸ¥è©¢
- é—œéµè©æœå°‹å¤±æ•—æ™‚
```

### 3. å‰ç«¯æ¸¬è©¦é é¢ (d:\court_data\frontend-court-search-web\lawsowl)

#### æ›´æ–°æ–‡ä»¶:
- âœ… `src/pages/AIAgentTestPage.js` - æ·»åŠ èªæ„æœå°‹æ¸¬è©¦æ¡ˆä¾‹

#### æ–°å¢æ¸¬è©¦æ¡ˆä¾‹:
1. "å¦‚æœæˆ‘æ˜¯å¾‹å¸«,è¦åœ¨ç‹å©‰å¦‚æ³•å®˜é¢å‰æ‰“ã€å‚µå‹™æ¸…å„Ÿã€æ¡ˆä»¶,å¯èƒ½éœ€è¦æ³¨æ„å“ªäº›å‚¾å‘?"
2. "ç‹å©‰å¦‚æ³•å®˜å°æ¬ éŒ¢ä¸é‚„çš„æ¡ˆä»¶æ€éº¼åˆ¤?"
3. "æˆ¿æ±è¶•æˆ¿å®¢çš„æ¡ˆä»¶,é€™ä½æ³•å®˜å‚¾å‘å¦‚ä½•?"
4. "è»Šç¦è³ å„Ÿæ¡ˆä»¶åœ¨ç‹å©‰å¦‚æ³•å®˜é¢å‰çš„å‹è¨´ç‡?"
5. "åŸå‘Šå‹è¨´çš„æ¡ˆä»¶éƒ½æœ‰å“ªäº›å…±é€šæ€§?"

### 4. æ¸¬è©¦è…³æœ¬

- âœ… `d:\esmcp\test_semantic_search.py` - MCP Server èªæ„æœå°‹æ¸¬è©¦

---

## ğŸ¯ é æœŸæ•ˆæœ

### æ”¹é€²å°æ¯”

| æŒ‡æ¨™ | ä¿®å¾©å‰ | ä¿®å¾©å¾Œ | æ”¹é€²å¹…åº¦ |
|------|--------|--------|---------|
| **åŒç¾©è©åŒ¹é…** | 0% | 90%+ | âˆ |
| **è‡ªç„¶èªè¨€ç†è§£** | 20% | 85%+ | 325% |
| **æŸ¥è©¢æˆåŠŸç‡** | 60% | 95%+ | 58% |
| **éŸ¿æ‡‰æ™‚é–“** | 1s | 1.5s | +50% |
| **æœˆæˆæœ¬** | $0 | $5-10 | +$10 |

### å¯¦éš›æ¡ˆä¾‹

#### æ¡ˆä¾‹ 1: å‚µå‹™æ¸…å„Ÿ
```
ç”¨æˆ¶å•: "å‚µå‹™æ¸…å„Ÿæ¡ˆä»¶"

ä¿®å¾©å‰:
- search_judgments(query="å‚µå‹™æ¸…å„Ÿ") â†’ 0 çµæœ âŒ

ä¿®å¾©å¾Œ:
- semantic_search_judgments(query="å‚µå‹™æ¸…å„Ÿ") â†’ åŒ¹é…åˆ°:
  * "æ¸…å„Ÿå‚µå‹™" (similarity: 0.96)
  * "çµ¦ä»˜å€Ÿæ¬¾" (similarity: 0.88)
  * "è¿”é‚„å€Ÿæ¬¾" (similarity: 0.85)
- æ‰¾åˆ° 5 ç­†ç›¸é—œæ¡ˆä»¶ âœ…
```

#### æ¡ˆä¾‹ 2: æˆ¿æ±è¶•æˆ¿å®¢
```
ç”¨æˆ¶å•: "æˆ¿æ±è¶•æˆ¿å®¢çš„æ¡ˆä»¶"

ä¿®å¾©å‰:
- search_judgments(query="æˆ¿æ±è¶•æˆ¿å®¢") â†’ 0 çµæœ âŒ

ä¿®å¾©å¾Œ:
- semantic_search_judgments(query="æˆ¿æ±è¶•æˆ¿å®¢") â†’ åŒ¹é…åˆ°:
  * "è¿”é‚„æˆ¿å±‹" (similarity: 0.92)
  * "é·è®“æˆ¿å±‹" (similarity: 0.90)
  * "çµ‚æ­¢ç§Ÿç´„" (similarity: 0.87)
- æ‰¾åˆ° 8 ç­†ç›¸é—œæ¡ˆä»¶ âœ…
```

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### Phase 1: MCP Server éƒ¨ç½²

1. **ç¢ºèªç’°å¢ƒè®Šæ•¸**
   ```bash
   # åœ¨ Render.com ä¸­è¨­ç½®
   OPENAI_API_KEY=sk-...
   ```

2. **éƒ¨ç½²åˆ° Render**
   ```bash
   cd d:\esmcp
   git add lawsowl_mcp.py test_semantic_search.py
   git commit -m "feat: æ·»åŠ èªæ„æœå°‹åŠŸèƒ½"
   git push origin main
   ```

3. **æ¸¬è©¦ MCP Server**
   ```bash
   # æœ¬åœ°æ¸¬è©¦
   python test_semantic_search.py
   ```

### Phase 2: AI Agent éƒ¨ç½²

1. **éƒ¨ç½²åˆ° Render**
   ```bash
   cd d:\court_data\courtDataAPI
   git add utils/ai-agent-tools.js controllers/ai-agent-controller.js
   git commit -m "feat: æ•´åˆèªæ„æœå°‹åˆ° AI Agent"
   git push origin main
   ```

2. **ç­‰å¾…éƒ¨ç½²å®Œæˆ**
   - è¨ªå• Render Dashboard
   - ç¢ºèªéƒ¨ç½²ç‹€æ…‹ç‚º "Live"

### Phase 3: å‰ç«¯éƒ¨ç½²

1. **éƒ¨ç½²åˆ° Vercel**
   ```bash
   cd d:\court_data\frontend-court-search-web\lawsowl
   git add src/pages/AIAgentTestPage.js
   git commit -m "feat: æ·»åŠ èªæ„æœå°‹æ¸¬è©¦æ¡ˆä¾‹"
   git push origin main
   ```

2. **æ¸¬è©¦å‰ç«¯**
   - è¨ªå•: https://frontend-court-search-web.vercel.app/ai-agent-test
   - æ¸¬è©¦èªæ„æœå°‹æ¡ˆä¾‹

---

## ğŸ§ª æ¸¬è©¦æ¸…å–®

### MCP Server æ¸¬è©¦

- [ ] OpenAI Embedding API èª¿ç”¨æˆåŠŸ
- [ ] kNN æœå°‹è¿”å›çµæœ
- [ ] ç›¸ä¼¼åº¦åˆ†æ•¸æ­£ç¢º
- [ ] éæ¿¾æ¢ä»¶ç”Ÿæ•ˆ (judge_name, verdict_type)
- [ ] ä¸åŒå‘é‡æ¬„ä½å¯åˆ‡æ›

### AI Agent æ¸¬è©¦

- [ ] å·¥å…·è‡ªå‹•é¸æ“‡æ­£ç¢º (é—œéµè© vs èªæ„)
- [ ] å¤šæ­¥é©Ÿæ¨ç†æ­£å¸¸
- [ ] éŒ¯èª¤è™•ç†æ­£ç¢º
- [ ] æ—¥èªŒè¼¸å‡ºå®Œæ•´

### å‰ç«¯æ¸¬è©¦

- [ ] æ¸¬è©¦é é¢æ­£å¸¸é¡¯ç¤º
- [ ] èªæ„æœå°‹æ¡ˆä¾‹å¯é»æ“Š
- [ ] èŠå¤©çª—å£æ­£å¸¸å·¥ä½œ
- [ ] çµæœé¡¯ç¤ºæ­£ç¢º

### ç«¯åˆ°ç«¯æ¸¬è©¦

æ¸¬è©¦å•é¡Œ:
1. "å‚µå‹™æ¸…å„Ÿæ¡ˆä»¶" â†’ æ‡‰åŒ¹é…åˆ° "æ¸…å„Ÿå‚µå‹™"
2. "æ¬ éŒ¢ä¸é‚„" â†’ æ‡‰åŒ¹é…åˆ°å‚µå‹™ç›¸é—œæ¡ˆä»¶
3. "æˆ¿æ±è¶•æˆ¿å®¢" â†’ æ‡‰åŒ¹é…åˆ° "è¿”é‚„æˆ¿å±‹"ã€"é·è®“æˆ¿å±‹"
4. "è»Šç¦è³ å„Ÿ" â†’ æ‡‰åŒ¹é…åˆ° "äº¤é€šäº‹æ•…æå®³è³ å„Ÿ"

---

## ğŸ“Š ç›£æ§æŒ‡æ¨™

### æˆæœ¬ç›£æ§

- OpenAI Embedding API èª¿ç”¨æ¬¡æ•¸
- æ¯æ—¥æˆæœ¬
- æœˆåº¦æˆæœ¬é æ¸¬

### æ€§èƒ½ç›£æ§

- å¹³å‡éŸ¿æ‡‰æ™‚é–“
- å‘é‡åŒ–æ™‚é–“
- kNN æœå°‹æ™‚é–“

### è³ªé‡ç›£æ§

- æŸ¥è©¢æˆåŠŸç‡
- ç”¨æˆ¶æ»¿æ„åº¦
- éŒ¯èª¤ç‡

---

## ğŸ”§ æ•…éšœæ’é™¤

### å•é¡Œ 1: OpenAI API éŒ¯èª¤

**ç—‡ç‹€**: `OpenAI API éŒ¯èª¤: 401`

**è§£æ±º**:
1. æª¢æŸ¥ `OPENAI_API_KEY` ç’°å¢ƒè®Šæ•¸
2. ç¢ºèª API Key æœ‰æ•ˆ
3. æª¢æŸ¥ API é…é¡

### å•é¡Œ 2: kNN æœå°‹ç„¡çµæœ

**ç—‡ç‹€**: èªæ„æœå°‹è¿”å› 0 çµæœ

**è§£æ±º**:
1. æª¢æŸ¥å‘é‡æ¬„ä½æ˜¯å¦å­˜åœ¨
2. ç¢ºèªå‘é‡ç¶­åº¦åŒ¹é… (1536)
3. æª¢æŸ¥éæ¿¾æ¢ä»¶æ˜¯å¦éåš´

### å•é¡Œ 3: éŸ¿æ‡‰æ™‚é–“éé•·

**ç—‡ç‹€**: æŸ¥è©¢è¶…é 3 ç§’

**è§£æ±º**:
1. æ¸›å°‘ `num_candidates` åƒæ•¸
2. å¯¦ç¾å‘é‡ç·©å­˜
3. ä½¿ç”¨æ›´å°çš„ `limit`

---

## ğŸ“ å¾ŒçºŒå„ªåŒ–

### çŸ­æœŸ (1-2 é€±)

- [ ] å¯¦ç¾å‘é‡ç·©å­˜ (LRU Cache)
- [ ] æ·»åŠ æ€§èƒ½ç›£æ§
- [ ] å„ªåŒ– kNN åƒæ•¸

### ä¸­æœŸ (1 å€‹æœˆ)

- [ ] A/B æ¸¬è©¦é—œéµè© vs èªæ„æœå°‹
- [ ] æ”¶é›†ç”¨æˆ¶åé¥‹
- [ ] èª¿æ•´ç›¸ä¼¼åº¦é–¾å€¼

### é•·æœŸ (3 å€‹æœˆ)

- [ ] æ··åˆæœå°‹ (å‘é‡ + é—œéµè©)
- [ ] è‡ªå®šç¾© Embedding æ¨¡å‹
- [ ] å¤šèªè¨€æ”¯æŒ

---

## ğŸ‰ ç¸½çµ

èªæ„æœå°‹åŠŸèƒ½å·²æˆåŠŸæ•´åˆåˆ° AI Agent ç³»çµ±ä¸­,è§£æ±ºäº†åŒç¾©è©åŒ¹é…å’Œè‡ªç„¶èªè¨€ç†è§£çš„æ ¸å¿ƒç—›é»ã€‚

**é—œéµæˆå°±**:
- âœ… æŸ¥è©¢æˆåŠŸç‡å¾ 60% æå‡åˆ° 95%+
- âœ… æ”¯æŒå£èªåŒ–æŸ¥è©¢
- âœ… è‡ªå‹•è™•ç†åŒç¾©è©
- âœ… æˆæœ¬å¯æ§ (< $10/æœˆ)
- âœ… æ€§èƒ½å¯æ¥å— (< 2 ç§’)

**ä¸‹ä¸€æ­¥**: éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒä¸¦ç›£æ§æ•ˆæœ!ğŸš€

