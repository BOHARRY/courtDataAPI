# 優化前後對比

## 📊 場景: 用戶問 "分析法官的判決統計數據"

**上下文**: 
- 法官: 黃麟捷
- 問題類型: 其他

---

## ❌ **優化前**

### **System Prompt 結構**
```
[基礎 Prompt - 2000 tokens]
  ↓
[範例 - 1500 tokens]
  ↓
[工具選擇策略 - 500 tokens]
  ↓
[關鍵規則 - 500 tokens]
  ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔴 **重要上下文**  ← 在最後面!
**法官姓名**: 黃麟捷
**問題類型**: 其他
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### **用戶問題**
```
分析法官的判決統計數據
```

### **GPT 的回答**
```
請提供您想要分析的法官姓名,以便我可以為您提供該法官在2025年6月至7月期間的判決統計數據。
```

### **問題**
- ❌ GPT 完全忽略了法官上下文
- ❌ 問用戶是哪位法官
- ❌ 沒有調用任何工具

---

## ✅ **優化後**

### **System Prompt 結構**
```
🔴 **當前對話上下文** (最高優先級 - 請優先閱讀)  ← 在最前面!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
**當前查詢的法官**: 黃麟捷

**關鍵規則** (必須遵守):
1. 用戶問題中的「法官」都是指「黃麟捷」法官
2. 在**所有**工具調用中,必須使用 judge_name="黃麟捷"
3. **不要**問用戶是哪位法官,直接使用「黃麟捷」
4. 如果用戶問題模糊,提供具體的分析選項,但明確是針對「黃麟捷」法官

**問題類型**: 其他

**用戶問題較為模糊,建議**:
1. 先調用 analyze_judge(judge_name="黃麟捷") 獲取法官整體統計
2. 根據結果,向用戶提供具體的分析選項,例如:
   - "您想了解黃麟捷法官的勝訴率分析嗎?"
   - "您想了解黃麟捷法官常引用的法條嗎?"
   - "您想了解黃麟捷法官的案由分布嗎?"
3. **重要**: 在回答中明確提到是「黃麟捷法官」,不要問用戶是哪位法官
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ↓
[基礎 Prompt]
  ↓
[範例]
  ↓
[工具選擇策略]
```

### **用戶問題 (增強後)**
```
[關於黃麟捷法官] 分析法官的判決統計數據
```

### **GPT 的預期回答 (選項 1)**
```
第1輪: 調用 analyze_judge(judge_name="黃麟捷")
  → 返回法官整體統計

第2輪: 生成回答
  "根據 2025年6-7月 的數據,黃麟捷法官的判決統計如下:
  
  - 總案件數: 45 件
  - 案由分布: 損害賠償 (18件), 返還不當得利 (12件), 債務清償 (8件)...
  - 原告勝訴率: 42.2%
  
  您想進一步了解哪方面的分析? 例如:
  - 特定案由的勝訴率
  - 常引用的法條
  - 判決金額趨勢"
```

### **GPT 的預期回答 (選項 2)**
```
您想了解黃麟捷法官的哪些統計數據? 我可以為您提供:

1. **勝訴率分析** - 原告/被告勝訴率,按案由分類
2. **案由分布** - 法官審理的案件類型分布
3. **常引用法條** - 法官在判決中常引用的法律條文
4. **判決金額趨勢** - 判決金額的統計分析
5. **判決傾向** - 法官的整體判決傾向分析

請告訴我您想了解哪方面的資訊?
```

### **改進**
- ✅ GPT 正確識別法官名稱
- ✅ 不問用戶是哪位法官
- ✅ 提供具體的分析選項
- ✅ 或直接調用工具獲取數據

---

## 📊 **關鍵差異對比**

| 項目 | 優化前 | 優化後 |
|------|--------|--------|
| **上下文位置** | 最後面 (容易被忽略) | 最前面 (優先級最高) |
| **上下文標記** | 無特殊標記 | "最高優先級 - 請優先閱讀" |
| **用戶問題** | 原始問題 | 增強後 `[關於黃麟捷法官] ...` |
| **針對模糊問題** | 無特殊處理 | 提供明確的建議工作流程 |
| **禁止行為** | 提到但不明顯 | 多次強調 "不要問用戶是哪位法官" |
| **GPT 行為** | ❌ 問用戶是哪位法官 | ✅ 提供具體選項或調用工具 |

---

## 🎯 **核心改進**

### **1. 上下文優先級**
```
優化前: [基礎 Prompt] → [範例] → [上下文]  ← 上下文在最後
優化後: [上下文] → [基礎 Prompt] → [範例]  ← 上下文在最前
```

### **2. 明確標記**
```
優化前: 🔴 **重要上下文**
優化後: 🔴 **當前對話上下文** (最高優先級 - 請優先閱讀)
```

### **3. 用戶問題增強**
```
優化前: "分析法官的判決統計數據"
優化後: "[關於黃麟捷法官] 分析法官的判決統計數據"
```

### **4. 針對模糊問題的建議**
```
優化前: 無
優化後: 
  - 建議調用 analyze_judge
  - 提供具體的分析選項範例
  - 強調要在回答中提到法官名稱
  - 明確禁止問用戶是哪位法官
```

---

## 📈 **預期效果提升**

### **問題識別率**
- 優化前: GPT 忽略法官上下文,問用戶是哪位法官
- 優化後: GPT 正確識別法官名稱,提供針對性回答

### **用戶體驗**
- 優化前: 用戶需要重複提供法官名稱 (已經在法官頁面了)
- 優化後: 系統自動識別,用戶無需重複

### **工具調用準確性**
- 優化前: 可能不調用工具,或調用時缺少 `judge_name` 參數
- 優化後: 正確調用工具,並包含 `judge_name="黃麟捷"` 參數

---

## 🔄 **完整流程對比**

### **優化前**
```
用戶: "分析法官的判決統計數據"
  ↓
Intent Classifier: { question_type: "其他" }
  ↓
System Prompt: [基礎 Prompt] + [上下文在最後]
  ↓
GPT: "請提供您想要分析的法官姓名"  ← ❌ 錯誤
  ↓
用戶: "黃麟捷"  ← 需要重複提供
  ↓
GPT: 調用工具...
```

### **優化後**
```
用戶: "分析法官的判決統計數據"
  ↓
Intent Classifier: { question_type: "其他" }
  ↓
System Prompt: [上下文在最前] + [基礎 Prompt]
用戶問題: "[關於黃麟捷法官] 分析法官的判決統計數據"
  ↓
GPT (選項1): 調用 analyze_judge(judge_name="黃麟捷")  ← ✅ 正確
  ↓
GPT (選項2): "您想了解黃麟捷法官的哪些統計數據?"  ← ✅ 正確
```

---

## 🎉 **總結**

通過三個關鍵改進:
1. ✅ **上下文優先** - 放在 System Prompt 最前面
2. ✅ **問題增強** - 明確包含法官名稱
3. ✅ **明確建議** - 針對模糊問題提供工作流程

**預期效果**:
- GPT 將能夠正確識別法官名稱
- 不再問用戶是哪位法官
- 提供更準確、更有針對性的回答
- 提升用戶體驗

