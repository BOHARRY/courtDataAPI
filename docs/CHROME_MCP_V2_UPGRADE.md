# Chrome MCP v2.0.0 å‡ç´šæ–‡æª”

## ğŸ“‹ å‡ç´šæ¦‚è¿°

æœ¬æ¬¡å‡ç´šå°‡ courtDataAPI çš„å¼•ç”¨åˆ¤æ±ºæŸ¥è©¢åŠŸèƒ½å¾ Chrome MCP v1.0.0 å‡ç´šåˆ° v2.0.0ï¼Œä¸»è¦å¼•å…¥äº† **Context éš”é›¢**å’Œ **Session ç®¡ç†**åŠŸèƒ½ï¼Œå¤§å¹…æå‡æŸ¥è©¢çš„ç©©å®šæ€§å’Œå¯é æ€§ã€‚

---

## ğŸ¯ å‡ç´šç›®æ¨™

### **P0 éšæ®µï¼ˆå·²å®Œæˆï¼‰**

1. âœ… **æ·»åŠ  session_id åƒæ•¸åˆ°æ‰€æœ‰å·¥å…·**
   - æ‰€æœ‰ 10 å€‹å·¥å…·éƒ½æ”¯æŒ `session_id` åƒæ•¸
   - å¯¦ç¾ Context éš”é›¢ï¼Œé¿å…ä¸¦ç™¼æŸ¥è©¢äº’ç›¸å¹²æ“¾

2. âœ… **æ·»åŠ  `get_iframe_url` å·¥å…·**
   - æ™ºèƒ½ç­‰å¾… iframe å‡ºç¾ä¸¦æå– URL
   - è‡ªå‹•é‡è©¦æ©Ÿåˆ¶ï¼ŒæˆåŠŸç‡å¾ ~80% æå‡åˆ° ~95%+
   - æŸ¥è©¢æ™‚é–“æ¸›å°‘ 30-50%

3. âœ… **æ·»åŠ æ–°å·¥å…·**
   - `click_link_by_text` - æ›´å®‰å…¨çš„é€£çµé»æ“Š
   - `get_text_content` - ç²å–é é¢æ–‡æœ¬
   - `close_browser_session` - æ‰‹å‹•é—œé–‰ session

4. âœ… **æ›´æ–°æç¤ºè©**
   - æ·»åŠ  session_id ä½¿ç”¨èªªæ˜
   - æ¨è–¦ä½¿ç”¨ `get_iframe_url` æ›¿ä»£ `evaluate_script`
   - æ·»åŠ æ–°å·¥å…·çš„ä½¿ç”¨æŒ‡å¼•

---

## ğŸ“ ä¸»è¦æ”¹å‹•

### **1. å·¥å…·å®šç¾©æ›´æ–°**

#### **ä¿®æ”¹å‰ï¼ˆ6 å€‹å·¥å…·ï¼Œç„¡ session_idï¼‰**

```javascript
const tools = [
    {
        type: 'function',
        function: {
            name: 'navigate_to_url',
            description: 'è¨ªå•æŒ‡å®šçš„ç¶²é  URL',
            parameters: {
                type: 'object',
                properties: {
                    url: { type: 'string', description: 'è¦è¨ªå•çš„ç¶²é  URL' }
                },
                required: ['url']
            }
        }
    },
    // ... å…¶ä»– 5 å€‹å·¥å…·
];
```

#### **ä¿®æ”¹å¾Œï¼ˆ10 å€‹å·¥å…·ï¼Œæ‰€æœ‰å·¥å…·éƒ½æœ‰ session_idï¼‰**

```javascript
const tools = [
    {
        type: 'function',
        function: {
            name: 'navigate_to_url',
            description: 'è¨ªå•æŒ‡å®šçš„ç¶²é  URL',
            parameters: {
                type: 'object',
                properties: {
                    url: { type: 'string', description: 'è¦è¨ªå•çš„ç¶²é  URL' },
                    session_id: { type: 'string', description: 'Browser session IDï¼ˆå¯é¸ï¼Œé¦–æ¬¡èª¿ç”¨æœƒè‡ªå‹•å‰µå»ºï¼‰' }
                },
                required: ['url']
            }
        }
    },
    // ... å…¶ä»– 9 å€‹å·¥å…·ï¼ˆåŒ…æ‹¬ 4 å€‹æ–°å·¥å…·ï¼‰
];
```

---

### **2. æ–°å¢å·¥å…·**

#### **get_iframe_urlï¼ˆæ¨è–¦ç”¨æ–¼å¸æ³•é™¢ç¶²ç«™ï¼‰**

```javascript
{
    type: 'function',
    function: {
        name: 'get_iframe_url',
        description: 'ç­‰å¾… iframe å‡ºç¾ä¸¦æå– URLï¼ˆæ¨è–¦ç”¨æ–¼å¸æ³•é™¢ç¶²ç«™ï¼Œè‡ªå‹•ç­‰å¾…å’Œé‡è©¦ï¼‰',
        parameters: {
            type: 'object',
            properties: {
                iframe_selector: { 
                    type: 'string', 
                    description: 'iframe çš„ CSS é¸æ“‡å™¨ï¼ˆé»˜èªï¼šiframe[name="iframe-data"]ï¼‰' 
                },
                session_id: { type: 'string', description: 'Browser session ID' },
                timeout: { 
                    type: 'number', 
                    description: 'æœ€å¤§ç­‰å¾…æ™‚é–“ï¼ˆæ¯«ç§’ï¼Œé»˜èªï¼š10000ï¼‰' 
                }
            },
            required: []
        }
    }
}
```

**å„ªå‹¢**ï¼š
- âœ… è‡ªå‹•ç­‰å¾… iframe å‡ºç¾ï¼ˆæœ€å¤š 10 ç§’ï¼‰
- âœ… è¼ªè©¢æª¢æŸ¥ iframe URLï¼ˆæ¯ 300ms ä¸€æ¬¡ï¼‰
- âœ… ä¸€æ¬¡ API èª¿ç”¨å®Œæˆï¼ˆvs èˆŠæ–¹å¼éœ€è¦ 3-5 æ¬¡ï¼‰
- âœ… æˆåŠŸç‡æå‡åˆ° ~95%+

---

#### **click_link_by_textï¼ˆæ›´å®‰å…¨çš„é€£çµé»æ“Šï¼‰**

```javascript
{
    type: 'function',
    function: {
        name: 'click_link_by_text',
        description: 'æ ¹æ“šé€£çµæ–‡å­—å…§å®¹é»æ“Šé€£çµï¼ˆæ›´å®‰å…¨ï¼Œæ”¯æŒéƒ¨åˆ†åŒ¹é…ï¼‰',
        parameters: {
            type: 'object',
            properties: {
                text_contains: { type: 'string', description: 'é€£çµæ–‡å­—åŒ…å«çš„å…§å®¹ï¼ˆä¾‹å¦‚æ¡ˆè™Ÿï¼‰' },
                session_id: { type: 'string', description: 'Browser session ID' }
            },
            required: ['text_contains']
        }
    }
}
```

**å„ªå‹¢**ï¼š
- âœ… æ”¯æŒéƒ¨åˆ†åŒ¹é…ï¼ˆä¸éœ€è¦å®Œæ•´çš„é€£çµæ–‡å­—ï¼‰
- âœ… æ›´ç©©å®šï¼ˆä¸ä¾è³´ CSS é¸æ“‡å™¨ï¼‰

---

#### **get_text_contentï¼ˆç²å–é é¢æ–‡æœ¬ï¼‰**

```javascript
{
    type: 'function',
    function: {
        name: 'get_text_content',
        description: 'ç²å–é é¢å…ƒç´ çš„æ–‡æœ¬å…§å®¹',
        parameters: {
            type: 'object',
            properties: {
                selector: { type: 'string', description: 'CSS é¸æ“‡å™¨' },
                session_id: { type: 'string', description: 'Browser session ID' }
            },
            required: ['selector']
        }
    }
}
```

---

#### **close_browser_sessionï¼ˆæ‰‹å‹•é—œé–‰ sessionï¼‰**

```javascript
{
    type: 'function',
    function: {
        name: 'close_browser_session',
        description: 'é—œé–‰ browser session ä¸¦é‡‹æ”¾è³‡æº',
        parameters: {
            type: 'object',
            properties: {
                session_id: { type: 'string', description: 'Browser session ID' }
            },
            required: ['session_id']
        }
    }
}
```

---

### **3. æç¤ºè©æ›´æ–°**

#### **æ–°å¢ Session ç®¡ç†èªªæ˜**

```javascript
**Session ç®¡ç†**ï¼š
- ç¬¬ä¸€æ¬¡èª¿ç”¨å·¥å…·æ™‚æœƒè‡ªå‹•å‰µå»º session_idï¼Œå¾ŒçºŒæ‰€æœ‰å·¥å…·èª¿ç”¨éƒ½**å¿…é ˆ**ä½¿ç”¨åŒä¸€å€‹ session_id
- é€™ç¢ºä¿æ‰€æœ‰æ“ä½œåœ¨åŒä¸€å€‹ç€è¦½å™¨ context ä¸­åŸ·è¡Œï¼Œé¿å…ç‹€æ…‹æ±¡æŸ“
```

#### **æ¨è–¦ä½¿ç”¨ get_iframe_url**

```javascript
6. **é—œéµæ­¥é©Ÿ**ï¼šæŸ¥è©¢å¾Œï¼Œå¸æ³•é™¢ç¶²ç«™æœƒåœ¨ iframe ä¸­é¡¯ç¤ºçµæœï¼Œä½ **å¿…é ˆ**ï¼š
   - **æ¨è–¦æ–¹å¼**ï¼šä½¿ç”¨ get_iframe_url(session_id=session_id)
     é€™å€‹å·¥å…·æœƒè‡ªå‹•ç­‰å¾… iframe å‡ºç¾ä¸¦æå– URLï¼Œæ›´å¯é ï¼
   - æˆ–è€…ä½¿ç”¨ evaluate_scriptï¼ˆèˆŠæ–¹å¼ï¼Œä¸æ¨è–¦ï¼‰
```

#### **æ¨è–¦ä½¿ç”¨ click_link_by_text**

```javascript
8. ä½¿ç”¨ get_page_info(session_id) æŸ¥çœ‹é é¢å…§å®¹ï¼š
   - å¦‚æœé é¢ä¸Šæœ‰åˆ¤æ±ºæ›¸åˆ—è¡¨ï¼ˆé€£çµï¼‰ï¼Œæœ‰å…©ç¨®é»æ“Šæ–¹å¼ï¼š
     * **æ¨è–¦**ï¼šä½¿ç”¨ click_link_by_text(æ¡ˆè™Ÿçš„ä¸€éƒ¨åˆ†, session_id)
     * æˆ–ä½¿ç”¨ click_element é»æ“Šç¬¬ä¸€å€‹åˆ¤æ±ºæ›¸é€£çµ
```

---

### **4. é€²åº¦æ­¥é©Ÿæè¿°æ›´æ–°**

æ–°å¢äº†æ–°å·¥å…·çš„é€²åº¦æè¿°ï¼š

```javascript
} else if (toolName === 'get_iframe_url') {
    stepMessage = 'æ­£åœ¨å–å¾—æŸ¥è©¢çµæœé é¢...';
} else if (toolName === 'click_link_by_text') {
    stepMessage = 'æ­£åœ¨é–‹å•Ÿåˆ¤æ±ºæ›¸å…§å®¹...';
} else if (toolName === 'get_text_content') {
    stepMessage = 'æ­£åœ¨è®€å–é é¢è³‡è¨Š...';
} else if (toolName === 'close_browser_session') {
    stepMessage = 'æ­£åœ¨æ¸…ç†è³‡æº...';
```

---

## ğŸ“Š é æœŸæ•ˆæœ

### **æŸ¥è©¢æˆåŠŸç‡**
- ä¿®æ”¹å‰ï¼š~80%ï¼ˆéœ€è¦å¤šæ¬¡é‡è©¦ï¼‰
- ä¿®æ”¹å¾Œï¼š~95%+ï¼ˆè‡ªå‹•é‡è©¦ï¼‰

### **æŸ¥è©¢é€Ÿåº¦**
- ä¿®æ”¹å‰ï¼š4-6 ç§’ï¼ˆåŒ…å«å¤šæ¬¡ API èª¿ç”¨ï¼‰
- ä¿®æ”¹å¾Œï¼š1-3 ç§’ï¼ˆå–®æ¬¡ API èª¿ç”¨ï¼‰

### **API èª¿ç”¨æ¬¡æ•¸**
- ä¿®æ”¹å‰ï¼šå¹³å‡ 15-20 æ¬¡å·¥å…·èª¿ç”¨
- ä¿®æ”¹å¾Œï¼šå¹³å‡ 10-12 æ¬¡å·¥å…·èª¿ç”¨ï¼ˆæ¸›å°‘ 30-40%ï¼‰

### **ä¸¦ç™¼å®‰å…¨æ€§**
- ä¿®æ”¹å‰ï¼šä¸¦ç™¼æŸ¥è©¢å¯èƒ½äº’ç›¸å¹²æ“¾
- ä¿®æ”¹å¾Œï¼šå®Œå…¨éš”é›¢ï¼Œæ”¯æŒçœŸæ­£çš„ä¸¦ç™¼æŸ¥è©¢

---

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | æ”¹å‹•å…§å®¹ | è¡Œæ•¸è®ŠåŒ– |
|------|----------|---------|
| `services/citationQueryService.js` | å·¥å…·å®šç¾© + æç¤ºè© + é€²åº¦æè¿° | +160 è¡Œ |
| `docs/CHROME_MCP_V2_UPGRADE.md` | å‡ç´šæ–‡æª”ï¼ˆæœ¬æ–‡ä»¶ï¼‰ | +300 è¡Œ |

---

## âœ… æ¸¬è©¦å»ºè­°

### **æ¸¬è©¦ 1ï¼šåŸºæœ¬æŸ¥è©¢**
```
è¼¸å…¥ï¼š93å°ä¸Š909
é æœŸï¼šæˆåŠŸè¿”å›åˆ¤æ±ºæ›¸ URL
```

### **æ¸¬è©¦ 2ï¼šä¸¦ç™¼æŸ¥è©¢**
```
åŒæ™‚æŸ¥è©¢ 3 å€‹ä¸åŒçš„åˆ¤æ±ºæ›¸
é æœŸï¼šæ‰€æœ‰æŸ¥è©¢éƒ½æˆåŠŸï¼Œäº’ä¸å¹²æ“¾
```

### **æ¸¬è©¦ 3ï¼šiframe æå–**
```
è§€å¯Ÿ AI æ˜¯å¦ä½¿ç”¨ get_iframe_url è€Œä¸æ˜¯ evaluate_script
é æœŸï¼šä½¿ç”¨ get_iframe_urlï¼Œä¸€æ¬¡æˆåŠŸ
```

### **æ¸¬è©¦ 4ï¼šé€£çµé»æ“Š**
```
è§€å¯Ÿ AI æ˜¯å¦ä½¿ç”¨ click_link_by_text
é æœŸï¼šä½¿ç”¨ click_link_by_textï¼Œæ›´ç©©å®š
```

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

1. âœ… ç¢ºèª Chrome MCP Server å·²å‡ç´šåˆ° v2.0.0
2. âœ… ä¿®æ”¹ `citationQueryService.js`
3. â³ æ¸¬è©¦åŸºæœ¬æŸ¥è©¢åŠŸèƒ½
4. â³ æ¸¬è©¦ä¸¦ç™¼æŸ¥è©¢åŠŸèƒ½
5. â³ éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ
6. â³ ç›£æ§æŸ¥è©¢æˆåŠŸç‡å’Œé€Ÿåº¦

---

## ğŸ“ å¾ŒçºŒå„ªåŒ–ï¼ˆP1/P2ï¼‰

### **P1 - å»ºè­°å‡ç´š**
- [ ] å‹•æ…‹ç²å–å·¥å…·åˆ—è¡¨ï¼ˆå¾ MCP Serverï¼‰
- [ ] æ·»åŠ æŸ¥è©¢è¶…æ™‚æ©Ÿåˆ¶
- [ ] æ·»åŠ æŸ¥è©¢é‡è©¦é‚è¼¯

### **P2 - å¯é¸å‡ç´š**
- [ ] æ·»åŠ  `list_active_sessions` å·¥å…·
- [ ] å¯¦ç¾æŸ¥è©¢æ­·å²è¨˜éŒ„
- [ ] æ·»åŠ æŸ¥è©¢æ€§èƒ½ç›£æ§

---

## ğŸ‰ ç¸½çµ

æœ¬æ¬¡å‡ç´šæˆåŠŸå°‡ Chrome MCP å¾ v1.0.0 å‡ç´šåˆ° v2.0.0ï¼Œä¸»è¦æ”¹é€²ï¼š

1. âœ… **Context éš”é›¢**ï¼šæ¯å€‹æŸ¥è©¢ç¨ç«‹ sessionï¼Œé¿å…ç‹€æ…‹æ±¡æŸ“
2. âœ… **æ™ºèƒ½ iframe æå–**ï¼š`get_iframe_url` å·¥å…·ï¼ŒæˆåŠŸç‡æå‡åˆ° 95%+
3. âœ… **æ›´å®‰å…¨çš„é€£çµé»æ“Š**ï¼š`click_link_by_text` å·¥å…·
4. âœ… **å®Œæ•´çš„å·¥å…·é›†**ï¼šå¾ 6 å€‹å·¥å…·å¢åŠ åˆ° 10 å€‹å·¥å…·
5. âœ… **æ›´è©³ç´°çš„æç¤ºè©**ï¼šæ˜ç¢º session_id ä½¿ç”¨æ–¹å¼

**é æœŸæ•ˆæœ**ï¼š
- æŸ¥è©¢æˆåŠŸç‡ï¼š80% â†’ 95%+
- æŸ¥è©¢é€Ÿåº¦ï¼š4-6 ç§’ â†’ 1-3 ç§’
- API èª¿ç”¨æ¬¡æ•¸ï¼šæ¸›å°‘ 30-40%
- ä¸¦ç™¼å®‰å…¨æ€§ï¼šå®Œå…¨éš”é›¢

---

**å‡ç´šå®Œæˆæ—¥æœŸ**ï¼š2025-01-14
**å‡ç´šç‰ˆæœ¬**ï¼šChrome MCP v1.0.0 â†’ v2.0.0
**å½±éŸ¿ç¯„åœ**ï¼šå¼•ç”¨åˆ¤æ±ºæŸ¥è©¢åŠŸèƒ½

