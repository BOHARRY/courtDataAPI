# ğŸš€ Smart Field Selection éƒ¨ç½²æª¢æŸ¥æ¸…å–®

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### 1. MCP Server (lawsowl_mcp.py) âœ…
- [x] æ·»åŠ æ¬„ä½æ˜ å°„é…ç½® (FIELD_LAYERS, ANALYSIS_TO_FIELDS)
- [x] æ·»åŠ  `get_fields_for_analysis()` å‡½æ•¸
- [x] ä¿®æ”¹ `SearchParams` æ·»åŠ  `intended_analysis` åƒæ•¸
- [x] ä¿®æ”¹ `SemanticSearchParams` æ·»åŠ  `intended_analysis` åƒæ•¸
- [x] ä¿®æ”¹ `search_judgments` å·¥å…·ä½¿ç”¨æ™ºèƒ½æ¬„ä½é¸æ“‡
- [x] ä¿®æ”¹ `semantic_search_judgments` å·¥å…·ä½¿ç”¨æ™ºèƒ½æ¬„ä½é¸æ“‡
- [x] å‹•æ…‹æ§‹å»ºåˆ¤æ±ºæ›¸ç‰©ä»¶ (åªåŒ…å«å¯¦éš›è¿”å›çš„æ¬„ä½)

### 2. å¾Œç«¯å·¥å…·å®šç¾© (ai-agent-tools.js) âœ…
- [x] æ·»åŠ  `intended_analysis` åƒæ•¸åˆ° `search_judgments` å·¥å…·å®šç¾©
- [x] æ·»åŠ  `intended_analysis` åƒæ•¸åˆ° `semantic_search_judgments` å·¥å…·å®šç¾©
- [x] æ›´æ–° System Prompt æ·»åŠ æ™ºèƒ½æ¬„ä½é¸æ“‡æŒ‡å°
- [x] æ›´æ–°ç¯„ä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨ `intended_analysis` åƒæ•¸

### 3. æ¸¬è©¦ âœ…
- [x] å‰µå»ºæ¸¬è©¦è…³æœ¬ (test_smart_fields.py)
- [x] é©—è­‰æ¬„ä½å±¤ç´šå®šç¾©
- [x] é©—è­‰åˆ†æé¡å‹æ˜ å°„
- [x] é©—è­‰ `get_fields_for_analysis()` å‡½æ•¸
- [x] ä¼°ç®— Token ç¯€çœæ•ˆæœ
- [x] æ‰€æœ‰æ¸¬è©¦é€šé (10/10)

---

## ğŸ“‹ éƒ¨ç½²å‰æª¢æŸ¥

### 1. ä»£ç¢¼æª¢æŸ¥
- [ ] æª¢æŸ¥ `lawsowl_mcp.py` æ²’æœ‰èªæ³•éŒ¯èª¤
- [ ] æª¢æŸ¥ `ai-agent-tools.js` æ²’æœ‰èªæ³•éŒ¯èª¤
- [ ] ç¢ºèªæ‰€æœ‰ä¿®æ”¹éƒ½å·²æäº¤åˆ° Git

### 2. ç’°å¢ƒè®Šæ•¸æª¢æŸ¥
- [ ] ç¢ºèª `.env` æ–‡ä»¶åŒ…å«æ‰€æœ‰å¿…è¦çš„ç’°å¢ƒè®Šæ•¸
  - [ ] `ES_URL`
  - [ ] `ES_API_KEY`
  - [ ] `ES_INDEX`
  - [ ] `OPENAI_API_KEY`

### 3. ä¾è³´æª¢æŸ¥
- [ ] ç¢ºèª MCP Server çš„ä¾è³´å·²å®‰è£ (`pip install -r requirements.txt`)
- [ ] ç¢ºèªå¾Œç«¯çš„ä¾è³´å·²å®‰è£ (`npm install`)

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### æ­¥é©Ÿ 1: éƒ¨ç½² MCP Server åˆ° Render.com

1. **æ¨é€ä»£ç¢¼åˆ° GitHub**
   ```bash
   cd d:\esmcp
   git add .
   git commit -m "feat: å¯¦æ–½æ™ºèƒ½æ¬„ä½é¸æ“‡ (Smart Field Selection)"
   git push origin main
   ```

2. **è§¸ç™¼ Render.com è‡ªå‹•éƒ¨ç½²**
   - Render.com æœƒè‡ªå‹•æª¢æ¸¬åˆ° GitHub æ›´æ–°
   - ç­‰å¾…éƒ¨ç½²å®Œæˆ (ç´„ 2-3 åˆ†é˜)
   - æª¢æŸ¥éƒ¨ç½²æ—¥èªŒç¢ºèªæ²’æœ‰éŒ¯èª¤

3. **é©—è­‰ MCP Server å¥åº·ç‹€æ…‹**
   ```bash
   curl https://your-mcp-server.onrender.com/ping
   ```
   é æœŸè¿”å›:
   ```json
   {
     "status": "healthy",
     "service": "LawSowl MCP Server",
     "timestamp": "2025-10-04T..."
   }
   ```

### æ­¥é©Ÿ 2: éƒ¨ç½²å¾Œç«¯åˆ° Vercel

1. **æ¨é€ä»£ç¢¼åˆ° GitHub**
   ```bash
   cd d:\court_data\courtDataAPI
   git add .
   git commit -m "feat: æ·»åŠ æ™ºèƒ½æ¬„ä½é¸æ“‡åƒæ•¸åˆ°å·¥å…·å®šç¾©"
   git push origin main
   ```

2. **è§¸ç™¼ Vercel è‡ªå‹•éƒ¨ç½²**
   - Vercel æœƒè‡ªå‹•æª¢æ¸¬åˆ° GitHub æ›´æ–°
   - ç­‰å¾…éƒ¨ç½²å®Œæˆ (ç´„ 1-2 åˆ†é˜)
   - æª¢æŸ¥éƒ¨ç½²æ—¥èªŒç¢ºèªæ²’æœ‰éŒ¯èª¤

3. **é©—è­‰å¾Œç«¯å¥åº·ç‹€æ…‹**
   ```bash
   curl https://your-backend.vercel.app/api/ai-agent/health
   ```

### æ­¥é©Ÿ 3: ç«¯åˆ°ç«¯æ¸¬è©¦

1. **æ¸¬è©¦å ´æ™¯ 1: åˆ—è¡¨æŸ¥è©¢ (é æœŸç¯€çœ 75% Token)**
   - å•é¡Œ: "åˆ—å‡ºç‹å©‰å¦‚æ³•å®˜çš„åˆ¤æ±ºæ›¸"
   - é æœŸ: GPT ä½¿ç”¨ `intended_analysis="list"`
   - é©—è­‰: è¿”å›çš„åˆ¤æ±ºæ›¸åªåŒ…å«åŸºæœ¬æ¬„ä½ (JID, JDATE, JTITLE, judges, verdict_type, court)

2. **æ¸¬è©¦å ´æ™¯ 2: å‹è¨´ç‡åˆ†æ (é æœŸç¯€çœ 75% Token)**
   - å•é¡Œ: "ç‹å©‰å¦‚æ³•å®˜åœ¨è¿”é‚„ä¸ç•¶å¾—åˆ©ä¸­çš„å‹è¨´ç‡?"
   - é æœŸ: GPT ä½¿ç”¨ `intended_analysis="verdict_rate"`
   - é©—è­‰: è¿”å›çš„åˆ¤æ±ºæ›¸åªåŒ…å«åŸºæœ¬æ¬„ä½

3. **æ¸¬è©¦å ´æ™¯ 3: é‡‘é¡åˆ†æ (é æœŸç¯€çœ 70% Token)**
   - å•é¡Œ: "é‡‘é¡æœ€å¤§çš„æ¡ˆä»¶æ˜¯å“ªä¸€å€‹?"
   - é æœŸ: GPT ä½¿ç”¨ `intended_analysis="amount_analysis"`
   - é©—è­‰: è¿”å›çš„åˆ¤æ±ºæ›¸åŒ…å«é‡‘é¡æ¬„ä½ (claim_amount, granted_amount)

4. **æ¸¬è©¦å ´æ™¯ 4: å‘å¾Œå…¼å®¹æ€§**
   - å•é¡Œ: "ç‹å©‰å¦‚æ³•å®˜çš„åˆ¤æ±ºå‚¾å‘?"
   - é æœŸ: GPT å¯èƒ½ä¸æŒ‡å®š `intended_analysis`ï¼Œç³»çµ±é è¨­è¿”å› summary å±¤
   - é©—è­‰: åŠŸèƒ½æ­£å¸¸é‹ä½œï¼Œæ²’æœ‰éŒ¯èª¤

---

## ğŸ“Š ç›£æ§æŒ‡æ¨™

### 1. Token æ¶ˆè€—ç›£æ§
- [ ] è¨˜éŒ„éƒ¨ç½²å‰çš„å¹³å‡ Token æ¶ˆè€—
- [ ] è¨˜éŒ„éƒ¨ç½²å¾Œçš„å¹³å‡ Token æ¶ˆè€—
- [ ] è¨ˆç®—å¯¦éš›ç¯€çœç™¾åˆ†æ¯”
- [ ] ç›®æ¨™: **ç¯€çœ 55-70% Token**

### 2. æˆæœ¬ç›£æ§
- [ ] è¨˜éŒ„éƒ¨ç½²å‰çš„æ¯æ—¥ OpenAI API æˆæœ¬
- [ ] è¨˜éŒ„éƒ¨ç½²å¾Œçš„æ¯æ—¥ OpenAI API æˆæœ¬
- [ ] è¨ˆç®—å¯¦éš›æˆæœ¬ç¯€çœ
- [ ] ç›®æ¨™: **ç¯€çœ 65-75% æˆæœ¬**

### 3. æº–ç¢ºç‡ç›£æ§
- [ ] è¨˜éŒ„éƒ¨ç½²å‰çš„æ•¸å€¼è¨ˆç®—æº–ç¢ºç‡
- [ ] è¨˜éŒ„éƒ¨ç½²å¾Œçš„æ•¸å€¼è¨ˆç®—æº–ç¢ºç‡
- [ ] ç›®æ¨™: **ç¶­æŒæˆ–æå‡æº–ç¢ºç‡**

### 4. ç”¨æˆ¶é«”é©—ç›£æ§
- [ ] è¨˜éŒ„éƒ¨ç½²å‰çš„å¹³å‡éŸ¿æ‡‰æ™‚é–“
- [ ] è¨˜éŒ„éƒ¨ç½²å¾Œçš„å¹³å‡éŸ¿æ‡‰æ™‚é–“
- [ ] ç›®æ¨™: **éŸ¿æ‡‰æ™‚é–“ä¸å¢åŠ **

---

## ğŸ› å›æ»¾è¨ˆç•«

å¦‚æœéƒ¨ç½²å¾Œç™¼ç¾å•é¡Œï¼Œå¯ä»¥å¿«é€Ÿå›æ»¾ï¼š

### MCP Server å›æ»¾
```bash
cd d:\esmcp
git revert HEAD
git push origin main
```

### å¾Œç«¯å›æ»¾
```bash
cd d:\court_data\courtDataAPI
git revert HEAD
git push origin main
```

---

## ğŸ“ éƒ¨ç½²å¾Œä»»å‹™

### 1. æ–‡æª”æ›´æ–°
- [ ] æ›´æ–° API æ–‡æª”èªªæ˜æ–°çš„ `intended_analysis` åƒæ•¸
- [ ] æ›´æ–°ç”¨æˆ¶æŒ‡å—èªªæ˜æ–°åŠŸèƒ½
- [ ] æ›´æ–°é–‹ç™¼è€…æ–‡æª”

### 2. åœ˜éšŠé€šçŸ¥
- [ ] é€šçŸ¥åœ˜éšŠæˆå“¡æ–°åŠŸèƒ½å·²ä¸Šç·š
- [ ] åˆ†äº« Token ç¯€çœæ•ˆæœå ±å‘Š
- [ ] æ”¶é›†åœ˜éšŠåé¥‹

### 3. æŒçºŒå„ªåŒ–
- [ ] æ ¹æ“šå¯¦éš›ä½¿ç”¨æƒ…æ³èª¿æ•´æ¬„ä½æ˜ å°„
- [ ] è€ƒæ…®å¯¦æ–½å„ªåŒ–å»ºè­° 1 (Router + Intent Classifier èåˆ)
- [ ] è€ƒæ…®å¯¦æ–½å„ªåŒ–å»ºè­° 2 (æ•¸æ“šé©—è­‰å±¤)

---

## âœ… éƒ¨ç½²å®Œæˆç¢ºèª

- [ ] MCP Server éƒ¨ç½²æˆåŠŸ
- [ ] å¾Œç«¯éƒ¨ç½²æˆåŠŸ
- [ ] æ‰€æœ‰æ¸¬è©¦å ´æ™¯é€šé
- [ ] Token æ¶ˆè€—ç›£æ§å·²è¨­ç½®
- [ ] æˆæœ¬ç›£æ§å·²è¨­ç½®
- [ ] åœ˜éšŠå·²é€šçŸ¥
- [ ] æ–‡æª”å·²æ›´æ–°

---

## ğŸ“ è¯çµ¡è³‡è¨Š

å¦‚æœ‰å•é¡Œï¼Œè«‹è¯çµ¡ï¼š
- é–‹ç™¼åœ˜éšŠ: [your-email@example.com]
- ç·Šæ€¥è¯çµ¡: [emergency-contact]

---

**éƒ¨ç½²æ—¥æœŸ**: _______________
**éƒ¨ç½²äººå“¡**: _______________
**é©—è­‰äººå“¡**: _______________

