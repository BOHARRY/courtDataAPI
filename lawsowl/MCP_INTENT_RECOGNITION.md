# ğŸ§  MCP æ„åœ–è­˜åˆ¥åŠŸèƒ½å¯¦ä½œ

> **å¯¦ä½œæ—¥æœŸ**: 2025-10-02  
> **åŠŸèƒ½**: AI æ„åœ–è­˜åˆ¥ + MCP æ™ºèƒ½èª¿ç”¨  
> **ç›®æ¨™**: æ”¯æŒæ¡ˆç”±ç¯©é¸çš„æ™ºèƒ½å•ç­”

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

### **æ ¸å¿ƒèƒ½åŠ›**

ç”¨æˆ¶å¯ä»¥è‡ªç„¶èªè¨€æå•,ç³»çµ±è‡ªå‹•è­˜åˆ¥æ„åœ–ä¸¦èª¿ç”¨å°æ‡‰çš„ MCP å·¥å…·:

```
ç”¨æˆ¶: "é€™ä½æ³•å®˜å°æ–¼äº¤é€šåˆ¤æ±ºçš„æœ€è¿‘20ç­†åˆ¤æ–·ç‹€æ³"
    â†“
[AI æ„åœ–è­˜åˆ¥]
    â†“
{
  "intent": "search_cases",
  "judge_name": "ç‹å©‰å¦‚",
  "case_type": "äº¤é€š",
  "limit": 20
}
    â†“
[MCP search_judgments]
    â†“
è¿”å› 20 ç­†äº¤é€šç›¸é—œåˆ¤æ±º
```

---

## ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ

### **æ•¸æ“šæµç¨‹**

```
å‰ç«¯ (JudgeMCPChat)
    â†“
parseIntent() â† èª¿ç”¨å¾Œç«¯ API
    â†“
Backend (/api/mcp/parse-intent)
    â†“
OpenAI GPT-4o-mini â† æ„åœ–è­˜åˆ¥
    â†“
è¿”å›çµæ§‹åŒ–æ„åœ–
    â†“
smartSearchJudgments() â† èª¿ç”¨ MCP
    â†“
MCP Server (search_judgments)
    â†“
Elasticsearch æŸ¥è©¢
    â†“
è¿”å›åˆ¤æ±ºæ›¸çµæœ
```

---

## ğŸ”§ å¯¦ä½œç´°ç¯€

### **1. å¾Œç«¯ API - æ„åœ–è­˜åˆ¥**

**æ–‡ä»¶**: `routes/mcp.js`

**ç«¯é»**: `POST /api/mcp/parse-intent`

**åŠŸèƒ½**: ä½¿ç”¨ OpenAI GPT-4o-mini è­˜åˆ¥ç”¨æˆ¶æ„åœ–

**è«‹æ±‚**:
```json
{
  "question": "é€™ä½æ³•å®˜å°æ–¼äº¤é€šåˆ¤æ±ºçš„æœ€è¿‘20ç­†åˆ¤æ–·ç‹€æ³",
  "currentJudge": {
    "name": "ç‹å©‰å¦‚"
  }
}
```

**éŸ¿æ‡‰**:
```json
{
  "success": true,
  "intent": {
    "intent": "search_cases",
    "judge_name": "ç‹å©‰å¦‚",
    "case_type": "äº¤é€š",
    "limit": 20,
    "additional_filters": {}
  }
}
```

**æ”¯æŒçš„æ„åœ–é¡å‹**:
- `search_cases` - æœå°‹åˆ¤æ±ºæ›¸
- `analyze_judge` - åˆ†ææ³•å®˜
- `compare_judges` - æ¯”è¼ƒæ³•å®˜ (æœªå¯¦ä½œ)
- `unknown` - æœªçŸ¥æ„åœ–

**æ¡ˆç”±é—œéµå­—æ˜ å°„**:
- "äº¤é€šäº‹æ•…"ã€"è»Šç¦" â†’ "äº¤é€š"
- "ä¾µæ¬Šè¡Œç‚º" â†’ "ä¾µæ¬Š"
- "å‚µå‹™"ã€"æ¸…å„Ÿå‚µå‹™" â†’ "å‚µå‹™"
- "è©æ¬º"ã€"è©é¨™" â†’ "è©æ¬º"
- "æå®³è³ å„Ÿ" â†’ "æå®³è³ å„Ÿ"

---

### **2. å‰ç«¯ Hook - æ™ºèƒ½æœå°‹**

**æ–‡ä»¶**: `lawsowl/src/hooks/useMCPJudgeAnalysis.js`

**æ–°å¢æ–¹æ³•**:

#### **parseIntent()**
```javascript
const parseIntent = useCallback(async (question, currentJudge = null) => {
  // èª¿ç”¨å¾Œç«¯ API è­˜åˆ¥æ„åœ–
  const response = await fetch(buildApiUrl('/mcp/parse-intent'), {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({ question, currentJudge })
  });
  
  const result = await response.json();
  return result.intent;
}, [getIdToken]);
```

#### **smartSearchJudgments()**
```javascript
const smartSearchJudgments = useCallback(async (judgeName, caseType = null, limit = 20) => {
  // æ§‹å»ºæœå°‹æŸ¥è©¢
  const query = caseType ? `${judgeName} ${caseType}` : judgeName;
  
  // èª¿ç”¨ MCP search_judgments å·¥å…·
  const mcpRequest = {
    jsonrpc: "2.0",
    id: Date.now(),
    method: "tools/call",
    params: {
      name: "search_judgments",
      arguments: {
        params: {
          query: query,
          limit: limit
        }
      }
    }
  };
  
  // ... MCP èª¿ç”¨é‚è¼¯
}, []);
```

---

### **3. å°è©±çµ„ä»¶ - æ„åœ–è™•ç†**

**æ–‡ä»¶**: `lawsowl/src/components/mcp/JudgeMCPChat.js`

**ä¿®æ”¹**: `handleFollowUpQuestion()`

```javascript
const handleFollowUpQuestion = async (question) => {
  // æ­¥é©Ÿ 1: è­˜åˆ¥æ„åœ–
  const intent = await parseIntent(question, currentJudge);
  
  // æ­¥é©Ÿ 2: æ ¹æ“šæ„åœ–èª¿ç”¨å°æ‡‰å·¥å…·
  if (intent.intent === 'search_cases') {
    const judgeName = intent.judge_name || currentJudge.name;
    const caseType = intent.case_type;
    const limit = intent.limit || 20;
    
    const searchResult = await smartSearchJudgments(judgeName, caseType, limit);
    const formattedResult = formatSearchResults(searchResult, caseType, limit);
    addMessage(formattedResult, 'assistant', searchResult);
  }
  // ... å…¶ä»–æ„åœ–è™•ç†
};
```

**æ–°å¢**: `formatSearchResults()`

æ ¼å¼åŒ–æœå°‹çµæœ,é¡¯ç¤ºåˆ¤æ±ºæ›¸åˆ—è¡¨ã€‚

---

## ğŸ¯ ä½¿ç”¨ç¯„ä¾‹

### **ç¯„ä¾‹ 1: åŸºæœ¬æ¡ˆç”±æœå°‹**

**ç”¨æˆ¶**: "é€™ä½æ³•å®˜çš„äº¤é€šæ¡ˆä»¶åˆ¤æ±ºå¦‚ä½•?"

**ç³»çµ±è™•ç†**:
1. è­˜åˆ¥æ„åœ–: `search_cases`
2. æå–æ¡ˆç”±: `äº¤é€š`
3. èª¿ç”¨ MCP: `search_judgments(query="ç‹å©‰å¦‚ äº¤é€š", limit=20)`
4. è¿”å›çµæœ

**é¡¯ç¤º**:
```
ğŸ“„ æœå°‹çµæœ

ğŸ” æ¡ˆç”±: äº¤é€š
âœ… æ‰¾åˆ° 15 ç­†åˆ¤æ±ºæ›¸,é¡¯ç¤ºå‰ 15 ç­†

**1. 110,å°ä¸Š,1234**
   ğŸ“… æ—¥æœŸ: 20211015
   ğŸ“‹ æ¡ˆç”±: éå¤±å‚·å®³
   âš–ï¸ çµæœ: åŸå‘Šå‹è¨´
   ğŸ‘¨â€âš–ï¸ æ³•å®˜: ç‹å©‰å¦‚
   
**2. 110,å°ä¸Š,5678**
   ...
```

---

### **ç¯„ä¾‹ 2: æŒ‡å®šæ•¸é‡**

**ç”¨æˆ¶**: "é¡¯ç¤ºæœ€è¿‘20ç­†ä¾µæ¬Šåˆ¤æ±º"

**ç³»çµ±è™•ç†**:
1. è­˜åˆ¥æ„åœ–: `search_cases`
2. æå–æ¡ˆç”±: `ä¾µæ¬Š`
3. æå–æ•¸é‡: `20`
4. èª¿ç”¨ MCP: `search_judgments(query="ç‹å©‰å¦‚ ä¾µæ¬Š", limit=20)`

---

### **ç¯„ä¾‹ 3: ç„¡æ¡ˆç”±æœå°‹**

**ç”¨æˆ¶**: "æŸ¥çœ‹é€™ä½æ³•å®˜çš„åˆ¤æ±ºæ›¸"

**ç³»çµ±è™•ç†**:
1. è­˜åˆ¥æ„åœ–: `search_cases`
2. æ¡ˆç”±: `null`
3. èª¿ç”¨ MCP: `search_judgments(query="ç‹å©‰å¦‚", limit=20)`

---

## âœ… æ”¯æŒçš„å•æ³•

### **æ¡ˆç”±æœå°‹**
```
âœ… "é€™ä½æ³•å®˜çš„äº¤é€šæ¡ˆä»¶åˆ¤æ±ºå¦‚ä½•?"
âœ… "é¡¯ç¤ºä¾µæ¬Šåˆ¤æ±º"
âœ… "æŸ¥çœ‹å‚µå‹™æ¡ˆä»¶"
âœ… "è»Šç¦æ¡ˆä»¶çš„åˆ¤æ±º"
âœ… "è©æ¬ºæ¡ˆä»¶æœ‰å“ªäº›?"
```

### **æŒ‡å®šæ•¸é‡**
```
âœ… "é¡¯ç¤ºæœ€è¿‘20ç­†åˆ¤æ±º"
âœ… "æŸ¥çœ‹10ç­†äº¤é€šæ¡ˆä»¶"
âœ… "çµ¦æˆ‘5å€‹ä¾µæ¬Šåˆ¤æ±º"
```

### **çµ„åˆæŸ¥è©¢**
```
âœ… "é€™ä½æ³•å®˜å°æ–¼äº¤é€šåˆ¤æ±ºçš„æœ€è¿‘20ç­†åˆ¤æ–·ç‹€æ³"
âœ… "é¡¯ç¤º15ç­†ä¾µæ¬Šæ¡ˆä»¶çš„åˆ¤æ±º"
```

---

## âŒ ç›®å‰é™åˆ¶

### **ä¸æ”¯æŒçš„åŠŸèƒ½**

1. **æ™‚é–“ç¯„åœ** âŒ
   ```
   âŒ "æœ€è¿‘ä¸€å¹´çš„åˆ¤æ±º"
   âŒ "2023å¹´çš„æ¡ˆä»¶"
   ```
   **åŸå› **: è³‡æ–™åº«åªæœ‰å…©å€‹æœˆçš„åˆ¤æ±ºæ›¸

2. **å¤šæ³•å®˜æ¯”è¼ƒ** âŒ
   ```
   âŒ "æ¯”è¼ƒç‹å©‰å¦‚å’Œé»ƒå»ºéƒ½"
   ```
   **åŸå› **: æœªå¯¦ä½œæ¯”è¼ƒé‚è¼¯

3. **è¤‡é›œç¯©é¸** âŒ
   ```
   âŒ "åŸå‘Šå‹è¨´çš„äº¤é€šæ¡ˆä»¶"
   âŒ "é‡‘é¡è¶…é100è¬çš„åˆ¤æ±º"
   ```
   **åŸå› **: MCP å·¥å…·ä¸æ”¯æŒè¤‡é›œç¯©é¸

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### **1. å¾Œç«¯éƒ¨ç½²**

ç¢ºä¿å¾Œç«¯å·²éƒ¨ç½²ä¸¦åŒ…å«æ–°çš„ `/api/mcp/parse-intent` ç«¯é»ã€‚

### **2. å‰ç«¯éƒ¨ç½²**

```bash
cd lawsowl
npm run build
# éƒ¨ç½²åˆ° Vercel
```

### **3. æ¸¬è©¦**

è¨ªå•: https://frontend-court-search-web.vercel.app/judge-mcp-demo

æ¸¬è©¦å•é¡Œ:
1. "åˆ†ææ³•å®˜ç‹å©‰å¦‚"
2. "é€™ä½æ³•å®˜çš„äº¤é€šæ¡ˆä»¶åˆ¤æ±ºå¦‚ä½•?"
3. "é¡¯ç¤ºæœ€è¿‘20ç­†ä¾µæ¬Šåˆ¤æ±º"

---

## ğŸ“Š æ€§èƒ½è€ƒé‡

### **OpenAI API èª¿ç”¨**

- **æ¨¡å‹**: GPT-4o-mini (ä¾¿å®œã€å¿«é€Ÿ)
- **æˆæœ¬**: ~$0.0001 per request
- **å»¶é²**: ~500ms

### **å„ªåŒ–å»ºè­°**

1. **ç·©å­˜å¸¸è¦‹æ„åœ–** - æ¸›å°‘ API èª¿ç”¨
2. **æœ¬åœ°é—œéµå­—åŒ¹é…** - ç°¡å–®å•é¡Œä¸èª¿ç”¨ AI
3. **æ‰¹é‡è™•ç†** - åˆä½µå¤šå€‹å•é¡Œ

---

## ğŸ”® æœªä¾†æ“´å±•

### **çŸ­æœŸ (1 é€±)**

1. **å¾‹å¸«æŸ¥è©¢** - æ•´åˆ `get_lawyer_history` å·¥å…·
2. **éŒ¯èª¤æç¤ºå„ªåŒ–** - æ›´å‹å¥½çš„éŒ¯èª¤è¨Šæ¯
3. **å¿«é€Ÿå•é¡ŒæŒ‰éˆ•** - é è¨­å¸¸è¦‹å•é¡Œ

### **ä¸­æœŸ (2-4 é€±)**

4. **å°è©±æ­·å²** - ç¶­è­·ä¸Šä¸‹æ–‡
5. **å¤šè¼ªæ¨ç†** - æ”¯æŒè¤‡é›œå•ç­”
6. **å¯è¦–åŒ–åœ–è¡¨** - Chart.js æ•´åˆ

### **é•·æœŸ (1-2 æœˆ)**

7. **RAG æ¶æ§‹** - æ·±åº¦åˆ¤æ±ºæ›¸åˆ†æ
8. **å¤šæ³•å®˜æ¯”è¼ƒ** - ä¸¦è¡Œåˆ†æ
9. **å°å‡ºå ±å‘Š** - PDF ç”Ÿæˆ

---

## ğŸ“ æ›´æ–°æ—¥èªŒ

### 2025-10-02
- âœ… å¯¦ä½œ AI æ„åœ–è­˜åˆ¥
- âœ… æ–°å¢ `parseIntent()` æ–¹æ³•
- âœ… æ–°å¢ `smartSearchJudgments()` æ–¹æ³•
- âœ… æ”¯æŒæ¡ˆç”±ç¯©é¸
- âœ… æ”¯æŒæ•¸é‡æŒ‡å®š

---

**ç¶­è­·è€…**: LawSowl Development Team  
**ç‰ˆæœ¬**: 1.1.0

